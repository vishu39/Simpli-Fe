<div>
  <h4>{{ selectedMasterOption?.name }}</h4>

  <div class="card p-3 mt-3" [formGroup]="topSelectionForm">
    <div class="row">
      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
        <mat-form-field class="example-full-width">
          <mat-label>Referral Partner</mat-label>
          <mat-select
            formControlName="referralPartner"
            [compareWith]="compareObjects"
          >
            <input
              class="searchInput"
              placeholder="search..."
              (keydown.space)="$event.stopPropagation()"
              matInput
              (keyup)="searchOwnReferralPartner($event.target.value)"
            />
            <div
              class="other_option"
              *ngIf="
                !ownReferralPartnerData?.length && !isLoadingOwnReferralPartner
              "
            >
              No results
            </div>
            <mat-spinner
              *ngIf="isLoadingOwnReferralPartnerSelectAll"
              class="mx-auto mb-2 mt-2"
              [diameter]="30"
            >
            </mat-spinner>

            <ng-container *ngIf="!isLoadingOwnReferralPartnerSelectAll">
              <mat-option
                (click)="
                  onClickOwnReferralPartner({
                    _id: item._id,
                    name: item.name
                  })
                "
                *ngFor="let item of ownReferralPartnerData"
                [value]="{
                  _id: item._id,
                  name: item.name
                }"
              >
                {{ item.name }}
              </mat-option>
            </ng-container>

            <mat-spinner
              *ngIf="
                isLoadingOwnReferralPartner &&
                !isLoadingOwnReferralPartnerSelectAll
              "
              class="mx-auto mb-2 mt-2"
              [diameter]="30"
            >
            </mat-spinner>
          </mat-select>
          <div class="chip_section" [perfectScrollbar]>
            <mat-chip-list>
              <mat-chip
                *ngFor="
                  let item of topSelectionForm.get('referralPartner').value
                "
              >
                {{ item?.name }}
              </mat-chip>
            </mat-chip-list>
          </div>
          <mat-error
            *ngIf="
              topSelectionForm.controls['referralPartner'].hasError('required')
            "
          >
            Referral Partner is required
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div class="tabsDiv card p-3">
      <mat-tab-group (selectedTabChange)="onTabChange($event)">
        <mat-tab
          label="Out Patient"
          [disabled]="!topSelectionForm?.get('referralPartner')?.value?.length"
        >
          <div *ngIf="selectedTab === 'Out Patient'">
            <app-op-partner-payout
              [referralPartner]="
                topSelectionForm?.get('referralPartner')?.value
              "
            ></app-op-partner-payout>
          </div>
        </mat-tab>

        <mat-tab
          label="In Patient"
          [disabled]="!topSelectionForm?.get('referralPartner')?.value?.length"
        >
          <div *ngIf="selectedTab === 'In Patient'">
            <app-ip-partner-payout
              [referralPartner]="
                topSelectionForm?.get('referralPartner')?.value
              "
            ></app-ip-partner-payout>
          </div>
        </mat-tab>

        <mat-tab
          label="Packages"
          [disabled]="!topSelectionForm?.get('referralPartner')?.value?.length"
        >
          <div *ngIf="selectedTab === 'Packages'">
            <app-packages-partner-payout
              [referralPartner]="
                topSelectionForm?.get('referralPartner')?.value
              "
            ></app-packages-partner-payout>
          </div>
          <!-- <div class="p-3">
          <form [formGroup]="packageForm" class="mt-2">
            <div class="row">
              <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
                <mat-form-field class="example-full-width" appearance="outline">
                  <mat-label>Select Package</mat-label>
                  <mat-select formControlName="package">
                    <mat-option
                      [value]="item?.value"
                      *ngFor="let item of packageOptionArray"
                      >{{ item?.name | titlecase }}
                    </mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="packageForm.controls['package'].hasError('required')"
                  >
                    Select Package is required
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
                <mat-form-field class="example-full-width" appearance="outline">
                  <mat-label>Payout In Percentage</mat-label>
                  <input
                    type="number"
                    formControlName="payoutInPercentage"
                    matInput
                  />
                  <mat-error
                    *ngIf="
                      packageForm.controls['payoutInPercentage'].hasError(
                        'required'
                      )
                    "
                  >
                    Payout In Percentage is required
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
                <mat-form-field class="example-full-width" appearance="outline">
                  <mat-label>Payout (Partner) In Percentage</mat-label>
                  <input
                    type="number"
                    formControlName="payoutPartnerInPercentage"
                    matInput
                  />
                  <mat-error
                    *ngIf="
                      packageForm.controls[
                        'payoutPartnerInPercentage'
                      ].hasError('required')
                    "
                  >
                    Payout (Partner) In Percentage is required
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
                <mat-form-field class="example-full-width" appearance="outline">
                  <mat-label>Payout In Fixed Amount</mat-label>
                  <input
                    type="number"
                    formControlName="payoutInFixedAmount"
                    matInput
                  />
                  <mat-error
                    *ngIf="
                      packageForm.controls['payoutInFixedAmount'].hasError(
                        'required'
                      )
                    "
                  >
                    Payout In Fixed Amount is required
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-2">
                <mat-form-field class="example-full-width" appearance="outline">
                  <mat-label>Payout (Partner) In Fixed Amount</mat-label>
                  <input
                    type="number"
                    formControlName="payoutPartnerInFixedAmount"
                    matInput
                  />
                  <mat-error
                    *ngIf="
                      packageForm.controls[
                        'payoutPartnerInFixedAmount'
                      ].hasError('required')
                    "
                  >
                    Payout (Partner) In Fixed Amount is required
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="mt-3">
              <button mat-raised-button color="primary" type="button">
                Submit
              </button>
            </div>
          </form>
        </div> -->
        </mat-tab>
        <mat-tab
          label="Slabs"
          [disabled]="!topSelectionForm?.get('referralPartner')?.value?.length"
        >
          Slabs
        </mat-tab>
        <mat-tab
          label="Incentive"
          [disabled]="!topSelectionForm?.get('referralPartner')?.value?.length"
        >
          Incentive
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>
