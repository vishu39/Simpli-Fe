<section class="content">
  <div class="content-block">
    <div class="block-header">
      <!-- breadcrumb -->
      <app-breadcrumb
        [title]="'User Permission'"
        [active_item]="'All Permission'"
      ></app-breadcrumb>
    </div>
    <div class="row">
      <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div class="card">
          <div class="body">
            <div id="mail-nav">
              <button
                type="button"
                (click)="addUserPermission()"
                class="btn btn-success waves-effect m-b-15 w-100"
              >
                ADD ROLE
              </button>
              <ul class="" id="mail-folders" *ngIf="userPermission.length">
                <li
                  class="active cursor_pointer"
                  *ngFor="let item of userPermission; let index = index"
                  [ngClass]="{ active: item.active === true }"
                >
                  <a (click)="onActive(item)">{{ item.roleName }} </a>
                </li>
              </ul>
            </div>

            <div *ngIf="isUserPermissionsLoading">
              <mat-spinner class="mx-auto mb-2 mt-2" [diameter]="30">
              </mat-spinner>
            </div>

            <div
              class="d-flex justify-content-center align-items-center"
              *ngIf="!isUserPermissionsLoading && !userPermission.length"
              class="text-secondary text-center"
            >
              -- No Data Found --
            </div>
          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
        <div class="card p-5">
          <div *ngIf="selectedRole">
            <h2 class="mb-5">
              Permissions
              <button
                mat-icon-button
                (click)="deleteUserPermission(selectedRole?._id)"
                class="tbl-action-btn"
              >
                <app-feather-icons
                  [icon]="'trash-2'"
                  [class]="'tbl-fav-delete'"
                ></app-feather-icons>
              </button>
            </h2>
            <form [formGroup]="userPermissionForm">
              <div class="row">
                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                  <mat-form-field
                    class="example-full-width"
                    appearance="outline"
                  >
                    <mat-label>Role Name</mat-label>
                    <input matInput type="text" formControlName="roleName" />
                    <mat-error
                      *ngIf="
                        userPermissionForm.controls['roleName'].hasError(
                          'required'
                        )
                      "
                    >
                      Role name is required
                    </mat-error>
                  </mat-form-field>
                </div>
                <mat-checkbox (change)="onSelect($event)"
                  >Select All</mat-checkbox
                >
              </div>
            </form>
            <div class="row">
              <div
                class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                *ngFor="let item of selectedRole?.modules"
              >
                <h4 class="mt-3 mb-3">{{ item.moduleName }}</h4>
                <div class="row">
                  <div
                    class="col-lg-4 col-md-6 col-sm-6 col-xs-6"
                    *ngFor="let key of objectKeys(item.permission)"
                  >
                    <mat-slide-toggle [(ngModel)]="item.permission[key]">
                      <span *ngIf="key === 'post'">add</span>
                      <span *ngIf="key === 'get'">view</span>
                      <span *ngIf="key === 'put'">edit</span>
                      <span
                        *ngIf="key !== 'post' && key !== 'get' && key !== 'put'"
                        >{{ key }}</span
                      >
                    </mat-slide-toggle>
                  </div>
                </div>
              </div>
            </div>
            <div class="row mt-5">
              <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                <div class="example-button-row">
                  <button
                    mat-raised-button
                    color="primary"
                    type="button"
                    (click)="formSubmit()"
                  >
                    Submit
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="isPermissionsLoading">
            <mat-spinner class="mx-auto mb-2 mt-2" [diameter]="30">
            </mat-spinner>
          </div>

          <div
            *ngIf="!isPermissionsLoading && !selectedRole"
            class="text-secondary text-center"
          >
            -- No Data Found --
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
