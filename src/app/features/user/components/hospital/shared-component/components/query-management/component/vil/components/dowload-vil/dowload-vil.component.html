<div mat-dialog-content>
  <form class="m-4" [formGroup]="emailFrom">
    <div class="row">
      <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-2">
        <mat-form-field class="example-full-width" appearance="outline">
          <mat-label>Format</mat-label>
          <mat-select formControlName="format">
            <mat-option
              (click)="onFormatChange(item?.value)"
              [value]="item?.value"
              *ngFor="let item of formatList"
              >{{ item?.title }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="emailFrom.controls['format'].hasError('required')">
            Format is required
          </mat-error>
        </mat-form-field>
      </div>

      <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 mb-2">
        <div class="multiple_select_custom">
          <mat-form-field class="example-full-width">
            <mat-label>Signatory</mat-label>
            <mat-select
              multiple
              formControlName="signatory"
              [compareWith]="compareObjects"
            >
              <input
                #myInput
                id="myInput"
                class="searchInput"
                placeholder="search..."
                (keydown.space)="$event.stopPropagation()"
                matInput
                (keyup)="searchSignatory($event.target.value)"
              />

              <div
                class="other_option"
                *ngIf="!signatoryData?.length && !isLoadingSignatory"
              >
                No results
              </div>

              <ng-container>
                <mat-option
                  (click)="onClickSignatory(item)"
                  *ngFor="let item of signatoryData"
                  [value]="{
                    _id: item._id,
                    name: item.signingAuthorityName
                  }"
                >
                  {{ item?.signingAuthorityName }}
                </mat-option>
              </ng-container>

              <mat-spinner
                *ngIf="isLoadingSignatory"
                class="mx-auto mb-2 mt-2"
                [diameter]="30"
              >
              </mat-spinner>
            </mat-select>

            <div class="chip_section" [perfectScrollbar]>
              <mat-chip-list>
                <mat-chip *ngFor="let item of emailFrom.get('signatory').value">
                  {{ item.name }}
                </mat-chip>
              </mat-chip-list>
            </div>

            <mat-error
              *ngIf="emailFrom.controls['signatory'].hasError('required')"
            >
              Signatory is required
            </mat-error>
          </mat-form-field>
        </div>
      </div>
    </div>

    <!-- vilReceived -->
    <div class="mt-4">
      <h5>VIL Requested</h5>
      <div *ngIf="request?.length">
        <div class="mt-4" *ngFor="let item of request">
          <mat-accordion>
            <mat-expansion-panel
              style="padding: 0rem 24px 0rem 24px !important"
              (opened)="panelOpenState = true"
              (closed)="panelOpenState = false"
            >
              <mat-expansion-panel-header #exPanel>
                <mat-panel-title>
                  <div (click)="!exPanel._toggle()">
                    <mat-checkbox (change)="selectChange($event, item, false)">
                      <p class="mb-0">
                        <b>{{ item?.hospitalName }}</b>
                      </p>
                    </mat-checkbox>
                  </div>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <shared-edit-vil
                [vilData]="item"
                [patientData]="patientData"
                (refetch)="refetch()"
                [comp]="'downloadVil'"
              ></shared-edit-vil>
            </mat-expansion-panel>
          </mat-accordion>
        </div>
      </div>
      <div class="" *ngIf="isDataLoading">
        <mat-spinner class="mx-auto mb-2 mt-2" [diameter]="30"> </mat-spinner>
      </div>

      <div class="card m-4 p-3" *ngIf="!isDataLoading && !request?.length">
        <div style="text-align: center">--No Data Found--</div>
      </div>
    </div>

    <!-- opinion code -->
    <div
      *ngIf="
        emailFrom.get('format')?.value?.toLowerCase()?.includes('ethiopia') ||
        emailFrom.get('format')?.value === 'amritaCommonNigeriaVilTemplate' ||
        emailFrom.get('format')?.value === 'sarvodyaCommonIraqVilTemplate' ||
        emailFrom.get('format')?.value === 'asterCommonNigeriaVilTemplate' ||
        emailFrom.get('format')?.value === 'nciCommonNigeriaVilTemplate' 
      "
    >
      <div class="mt-4">
        <h5 style="margin-bottom: 16px">Opinion Added</h5>
        <div *ngIf="opinionRequest?.length">
          <div class="mb-2" *ngFor="let item of opinionRequest">
            <mat-accordion>
              <mat-expansion-panel
                (opened)="panelOpenState = true"
                (closed)="panelOpenState = false"
              >
                <mat-expansion-panel-header
                  displayMode="flat"
                  expandedHeight="auto"
                  collapsedHeight="auto"
                  #exPanel
                >
                  <mat-panel-title>
                    <div class="expansion-header">
                      <div class="mt-3 mb-2" (click)="!exPanel._toggle()">
                        <mat-radio-button
                          [value]="item?._id"
                          (change)="opinionSelectChange($event, item, false)"
                        >
                          <p class="checkbox-label">
                            {{ item?.hospitalName }}
                          </p>
                        </mat-radio-button>
                        <!-- <mat-checkbox
                          (change)="selectChange($event, item, false)"
                        >
                          <p class="mb-0">
                            <b>{{ item?.hospitalName }}</b>
                          </p>
                        </mat-checkbox> -->
                      </div>
                      <div class="header-content hide-scrollbar">
                        <div class="hide-scrollbar content">
                          <p>Stay in country</p>
                          <span
                            >{{ item?.stayInCountry }}
                            {{ item?.countryDuration | titlecase }}</span
                          >
                        </div>
                        <div class="hide-scrollbar content">
                          <p>Stay in hospital</p>
                          <span
                            >{{ item?.stayInHospital }}
                            {{ item?.hospitalDuration | titlecase }}</span
                          >
                        </div>
                        <div class="hide-scrollbar content">
                          <p>Initial Evaluation</p>
                          <span
                            >{{ item?.initialEvaluationMinimum }} -
                            {{ item?.initialEvaluationMaximum }}
                            {{ item?.currency?.code || "USD" }}</span
                          >
                        </div>
                        <div class="hide-scrollbar diagnosis">
                          <p>Diagnosis</p>
                          <span>{{ item?.diagnosis }}</span>
                        </div>
                      </div>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="p-3 expansion-wrapper">
                  <div class="row">
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Doctor Name</b></div>
                      <div>{{ item?.doctorName }}</div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Hospital City</b></div>
                      <div>{{ item?.hospitalCity }}</div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Treatment Plan</b></div>
                      <div>{{ item?.treatmentPlan }}</div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Currency</b></div>
                      <div>
                        {{
                          !!item?.currency?.code ? item?.currency?.code : "NIL"
                        }}
                        -
                        {{
                          !!item?.currency?.name ? item?.currency?.name : "NIL"
                        }}
                      </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Received At</b></div>
                      <div>
                        {{ (item?.receivedAt | date : "medium") || "NIL" }}
                      </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Created At</b></div>
                      <div>{{ item?.createdAt | date : "medium" }}</div>
                    </div>
                  </div>
                  <div>
                    <div><b>Remarks</b></div>
                    <div>{{ item?.remarks || "NIL" }}</div>
                  </div>
                </div>

                <!-- for treatment -->
                <div
                  *ngIf="item?.treatment?.length"
                  class="p-3 mt-3 expansion-wrapper"
                >
                  <h5>Treatment Details</h5>
                  <div *ngFor="let treatment of item?.treatment; let i = index">
                    <div class="mt-4">
                      <p>
                        <b>Treatment {{ i + 1 }}</b>
                      </p>
                      <div class="row">
                        <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                          <div><b>Name</b></div>
                          <div>{{ treatment?.name || "NIL" }}</div>
                        </div>
                        <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                          <div><b>Room</b></div>
                          <div>{{ treatment?.room || "NIL" }}</div>
                        </div>
                        <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                          <div><b>Min Cost</b></div>
                          <div>
                            {{ treatment?.minCost }}
                            {{ item?.currency?.code || "USD" }}
                          </div>
                        </div>
                        <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                          <div><b>Max Cost</b></div>
                          <div>
                            {{ treatment?.maxCost }}
                            {{ item?.currency?.code || "USD" }}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
        </div>
        <div class="" *ngIf="isOpinionDataLoading">
          <mat-spinner class="mx-auto mb-2 mt-2" [diameter]="30"> </mat-spinner>
        </div>

        <div
          class="card m-4 p-3"
          *ngIf="!isOpinionDataLoading && !opinionRequest?.length"
        >
          <div style="text-align: center">--No Data Found--</div>
        </div>
      </div>

      <div class="mt-4">
        <h5 style="margin-bottom: 16px">Opinion Added Edited</h5>
        <div *ngIf="opinionRequestEdited?.length">
          <div class="mb-2" *ngFor="let item of opinionRequestEdited">
            <mat-accordion>
              <mat-expansion-panel
                (opened)="panelOpenState = true"
                (closed)="panelOpenState = false"
              >
                <mat-expansion-panel-header
                  displayMode="flat"
                  expandedHeight="auto"
                  collapsedHeight="auto"
                  #exPanel
                >
                  <mat-panel-title>
                    <div class="expansion-header">
                      <div class="mt-3 mb-2" (click)="!exPanel._toggle()">
                        <mat-radio-button
                          [value]="item?._id"
                          (change)="opinionSelectChange($event, item, true)"
                        >
                          <p class="checkbox-label">
                            {{ item?.hospitalName }}
                          </p>
                        </mat-radio-button>
                        <!-- <mat-checkbox (change)="selectChange($event, item, true)">
                          <p class="mb-0">
                            <b>{{ item?.hospitalName }}</b>
                          </p>
                        </mat-checkbox> -->
                      </div>
                      <div class="header-content hide-scrollbar">
                        <div class="hide-scrollbar content">
                          <p>Stay in country</p>
                          <span
                            >{{ item?.stayInCountry }}
                            {{ item?.countryDuration | titlecase }}</span
                          >
                        </div>
                        <div class="hide-scrollbar content">
                          <p>Stay in hospital</p>
                          <span
                            >{{ item?.stayInHospital }}
                            {{ item?.hospitalDuration | titlecase }}</span
                          >
                        </div>
                        <div class="hide-scrollbar content">
                          <p>Initial Evaluation</p>
                          <span
                            >{{ item?.initialEvaluationMinimum }} -
                            {{ item?.initialEvaluationMaximum }}
                            {{ item?.currency?.code || "USD" }}</span
                          >
                        </div>
                        <div class="hide-scrollbar diagnosis">
                          <p>Diagnosis</p>
                          <span>{{ item?.diagnosis }}</span>
                        </div>
                      </div>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="p-3 expansion-wrapper">
                  <div class="row">
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Doctor Name</b></div>
                      <div>{{ item?.doctorName }}</div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Hospital City</b></div>
                      <div>{{ item?.hospitalCity }}</div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Treatment Plan</b></div>
                      <div>{{ item?.treatmentPlan }}</div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Currency</b></div>
                      <div>
                        {{
                          !!item?.currency?.code ? item?.currency?.code : "NIL"
                        }}
                        -
                        {{
                          !!item?.currency?.name ? item?.currency?.name : "NIL"
                        }}
                      </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Received At</b></div>
                      <div>
                        {{ (item?.receivedAt | date : "medium") || "NIL" }}
                      </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                      <div><b>Created At</b></div>
                      <div>{{ item?.createdAt | date : "medium" }}</div>
                    </div>
                  </div>
                  <div>
                    <div><b>Remarks</b></div>
                    <div>{{ item?.remarks || "NIL" }}</div>
                  </div>
                </div>

                <!-- for treatment -->
                <div
                  *ngIf="item?.treatment?.length"
                  class="p-3 mt-3 expansion-wrapper"
                >
                  <h5>Treatment Details</h5>
                  <div *ngFor="let treatment of item?.treatment; let i = index">
                    <div class="mt-4">
                      <p>
                        <b>Treatment {{ i + 1 }}</b>
                      </p>
                      <div class="row">
                        <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                          <div><b>Name</b></div>
                          <div>{{ treatment?.name || "NIL" }}</div>
                        </div>
                        <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                          <div><b>Room</b></div>
                          <div>{{ treatment?.room || "NIL" }}</div>
                        </div>
                        <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                          <div><b>Min Cost</b></div>
                          <div>
                            {{ treatment?.minCost }}
                            {{ item?.currency?.code || "USD" }}
                          </div>
                        </div>
                        <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-2">
                          <div><b>Max Cost</b></div>
                          <div>
                            {{ treatment?.maxCost }}
                            {{ item?.currency?.code || "USD" }}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
        </div>
        <div class="" *ngIf="isOpinionEditedDataLoading">
          <mat-spinner class="mx-auto mb-2 mt-2" [diameter]="30"> </mat-spinner>
        </div>

        <div
          class="card m-4 p-3"
          *ngIf="!isOpinionEditedDataLoading && !opinionRequestEdited?.length"
        >
          <div style="text-align: center">--No Data Found--</div>
        </div>
      </div>
    </div>

    <mat-error
      class="mt-3"
      *ngIf="
        emailFrom.controls['selectHospital'].touched &&
        emailFrom.controls['selectHospital'].invalid
      "
      >Hospital Selection is required</mat-error
    >

    <div class="mt-4">
      <button type="button" mat-flat-button color="primary" (click)="submit()">
        Submit
      </button>
    </div>
  </form>
</div>
